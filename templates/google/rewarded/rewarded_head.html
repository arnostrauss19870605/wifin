<script>
    googletag = window.googletag || {cmd: []};

    const queryValues = window.location.search;
    const urlParams = new URLSearchParams(queryValues);
    var utm_medium = "NULL"
    if (urlParams.has('utm_medium') === true){
          utm_medium = urlParams.get('utm_medium');
          console.log("Utm Medium does exisit as :" ,utm_medium );
      } else {
        console.log("Utm Medium does not exisit exisit, value to be populated : ", utm_medium);
      }

    googletag.cmd.push(() => {
    
    const rewardedSlot = googletag.defineOutOfPageSlot('147246189,22047902240/wifinews.co.za_rewarded',googletag.enums.OutOfPageFormat.REWARDED).addService(googletag.pubads());
      rewardedSlot.setForceSafeFrame(true);
    
      googletag.pubads().setTargeting("utm_medium", [utm_medium]);
      googletag.pubads().enableAsyncRendering();
      googletag.enableServices();
      
      googletag.pubads().addEventListener('rewardedSlotReady', evt => {
        
        const makeVisibleFn = (e) => {
        
         
          
          evt.makeRewardedVisible();
          e.preventDefault();
          
          watchAdButton.removeEventListener('click', makeVisibleFn);
          
          noThanksButton.removeEventListener('click', closeModalFn);
          trigger.style.display = 'none';
        };


        const trigger = document.getElementById('rewardModal');
        trigger.style.display = 'block';
   
        const watchAdButton = document.getElementById('watchAdBtn');
        watchAdButton.addEventListener('click', makeVisibleFn);
        
        const noThanksButton = document.getElementById('noThanksBtn');
        const closeModalFn = () => {
          const trigger = document.getElementById('rewardModal');
          trigger.style.display = 'none';
          cancelPage();
        googletag.destroySlots([rewardedSlot]);
        };
        
        noThanksButton.addEventListener('click', closeModalFn);
        nextPage(); 
      });

       googletag.pubads().addEventListener('rewardedSlotGranted', function(evt) {
        googletag.destroySlots([rewardedSlot]);
        nextPage(); 

          });googletag.pubads().addEventListener("rewardedSlotClosed", (event) => {
            const slot = event.slot;
            console.log("Rewarded ad slot", slot.getSlotElementId(), "has been closed.");
            //location.reload();
            cancelPage();
            if (slot === targetSlot) {
              // Slot specific logic.
            }
            });
  


      googletag.display(rewardedSlot);
    });
  </script>
